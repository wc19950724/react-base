"use strict";(self.webpackChunkreact_base=self.webpackChunkreact_base||[]).push([[931],{3986:(e,t,s)=>{s.d(t,{C3:()=>d,Of:()=>c,jk:()=>h});var r=s(1527),n=s(2625),i=s(4727),o=s(959),a=s(4222);const c=(0,i.Pi)((e=>{const[t,s]=(0,o.useState)({FPS:0,zoom:1,vptCoordsTL:"0, 0",vptCoordsBR:"0, 0"});return(0,o.useEffect)((()=>{s({...t,...e})}),[e]),(0,r.jsx)(a.ZP,{data:t,onUpdate:()=>{},liveUpdate:!1,style:{position:"absolute",height:"fit-content",left:0,bottom:0,top:"unset",right:"unset"},children:(0,r.jsxs)(a.zI,{title:"Fabric.js",closed:!1,children:[(0,r.jsx)(a.OM,{path:"FPS",label:"FPS"}),(0,r.jsx)(a.OM,{path:"zoom",label:"zoom"}),(0,r.jsx)(a.OM,{path:"vptCoordsTL",label:"vptCoordsTL"}),(0,r.jsx)(a.OM,{path:"vptCoordsBR",label:"vptCoordsBR"})]})})}));class h{beginTime;prevTime;frames;FPS;constructor(){this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.FPS=0}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;const e=(performance||Date).now();return e>=this.prevTime+1e3&&(this.FPS=Math.round(1e3*this.frames/(e-this.prevTime)),this.prevTime=e,this.frames=0),e}update(){this.beginTime=this.end()}}class d{gui;constructor(){(0,n.ky)(this),this.gui={FPS:0,zoom:1,vptCoordsTL:"0, 0",vptCoordsBR:"0, 0"}}setGui(e){this.gui={...this.gui,...e}}}},5253:(e,t,s)=>{var r;s.d(t,{p:()=>n}),function(e){e.DEFAULT="DEFAULT",e.RESIZE="RESIZE"}(r||(r={}));const n=()=>{const e=new Map;return{lock:e,handler:(t,s=r.DEFAULT)=>{let n;return n=e.has(s)?e.get(s):window.requestAnimationFrame((r=>{t(r),e.delete(s)})),e.set(s,n),t=>{const s=e.get(t);e.delete(t),window.cancelAnimationFrame(s??0)}}}}},8931:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var r=s(1527),n=s(4585),i=s(2699),o=s(4727),a=s(959),c=s(3986),h=s(1993);const d=(0,o.Pi)((()=>{const e=(0,a.useRef)(null),t=(0,a.useRef)();(0,a.useEffect)((()=>{if(e.current){const s=new n.Xz(h.aK,{width:e.current.offsetWidth,height:e.current.offsetHeight,backgroundColor:"#232829",selection:!1,renderOnAddRemove:!1});return t.current=new h.Rh(s),t.current.renderViewport(),()=>{s.dispose(),t.current?.reset()}}}),[e.current]);const[s,o]=(0,a.useState)({});return(0,a.useEffect)((()=>{(0,i.isEqual)(t.current?.metrics.gui,s)||o({...t.current?.metrics.gui})}),[t.current?.metrics.gui]),(0,r.jsxs)("div",{ref:e,id:h.wo,style:{width:"100%",height:"100%",display:"block",position:"relative"},children:[(0,r.jsx)("canvas",{id:h.aK}),(0,r.jsx)(c.Of,{...s})]})}))},1993:(e,t,s)=>{s.d(t,{Rh:()=>l,YC:()=>p,aK:()=>c,wo:()=>h});var r=s(4585),n=s(2699),i=s(3986),o=s(5253),a=s(7217);const c="my-canvas",h="canvas-wrapper",{handler:d}=(0,o.p)();class u{canvas;rafId=0;lastVptCoords=null;rightMouseDown=!1;stats;metrics;constructor(e){this.canvas=e,this.canvasEvents(),this.stats=new i.jk,this.metrics=new i.C3}canvasEvents(){this.canvas?.on("mouse:wheel",(e=>d((()=>this.canvasWheelHandler(e))))),this.canvas?.on("mouse:move",(e=>d((()=>this.canvasMoveHandler(e)))));const e=document.getElementById(h);e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e.addEventListener("mousedown",(e=>{2===e.button&&(this.rightMouseDown=!0,this.canvas?.setCursor("move"))})),e.addEventListener("mouseup",(e=>{2===e.button&&(this.rightMouseDown=!1,this.canvas?.setCursor("default"))}))}canvasWheelHandler({e}){e.preventDefault();let t=this.canvas?.getZoom()??1;t*=.999**(2*e.deltaY),t>16&&(t=16),t<.0625&&(t=.0625),this.canvas?.zoomToPoint(new r.E9({x:e.offsetX,y:e.offsetY}),t),this.metrics.setGui({zoom:t}),this.canvas?.requestRenderAll()}canvasMoveHandler({e}){if(e.preventDefault(),!this.rightMouseDown||e instanceof TouchEvent)return;this.canvas?.setCursor("move");const t=new r.E9(e.movementX,e.movementY);this.canvas?.relativePan(t),this.canvas?.requestRenderAll()}reset(){this.canvas=null,this.rafId=0,this.lastVptCoords=null}}class l extends u{drawGroup=[];renderedMapFeatures=[];constructor(e){super(e),this.render()}isObjectInViewport(){const e=this.canvas?.vptCoords;if(!e||(0,n.isEqual)(this.lastVptCoords,e))return;console.time("renderViewport"),this.lastVptCoords=e;const{tl:t,br:s}=e;this.metrics.setGui({vptCoordsTL:`${t.y.toFixed(0)}, ${t.x.toFixed(0)}`,vptCoordsBR:`${s.y.toFixed(0)}, ${s.x.toFixed(0)}`});const r=[];this.drawGroup.forEach((e=>{const{x:n,y:i}=e.getCenterPoint(),o=n+e.width/2,a=i+e.height/2,c=n-e.width/2,h=i-e.height/2;o>=t.x&&c<=s.x&&a>=t.y&&h<=s.y&&r.push(e)}));const i=(0,n.difference)(r,this.renderedMapFeatures);this.canvas?.add(...i);const o=(0,n.difference)(this.renderedMapFeatures,r);this.canvas?.remove(...o),this.canvas?.requestRenderAll(),this.renderedMapFeatures=r,console.log(`objects count: ${this.canvas?.getObjects().length}`),console.timeEnd("renderViewport")}render(){const e=["#ffcc66","#ccff66","#66ccff","#ff6fcf","#ff6666"],t=e.length-1,s=this.canvas.getWidth(),n=this.canvas.getHeight();for(let i=0;i<1e4;i++){const i=new r.Cd({left:(0,a.X)(0,s),top:(0,a.X)(0,n),radius:3,fill:e[(0,a.X)(0,t)],objectCaching:!1,selectable:!1,evented:!1});this.drawGroup.push(i)}}renderViewport(){this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame((()=>{this.renderViewport()})),this.stats.begin(),this.isObjectInViewport(),this.stats.end(),this.metrics.setGui({FPS:this.stats.FPS})}reset(){super.reset(),this.drawGroup=[],this.renderedMapFeatures=[]}}class p extends u{drawGroup=[[]];renderedMapFeatures=[[]];constructor(e){super(e),this.render()}isObjectInViewport(){const e=this.canvas?.vptCoords;if(!e||(0,n.isEqual)(this.lastVptCoords,e))return;console.time("renderViewport"),this.lastVptCoords=e;const{tl:t,br:s}=e;this.metrics.setGui({vptCoordsTL:`${t.y.toFixed(0)}, ${t.x.toFixed(0)}`,vptCoordsBR:`${s.y.toFixed(0)}, ${s.x.toFixed(0)}`});const i=this.canvas?.getObjects();this.drawGroup.forEach(((e,o)=>{const[a]=i?.filter((e=>e.get("id")===`group_${o}`))||[];if(!(a instanceof r.ZA))return;const c=[];e.forEach((e=>{const{x:r,y:n}=e.getCenterPoint(),i=r+e.width/2,o=n+e.height/2,a=r-e.width/2,h=n-e.height/2;i>=t.x&&a<=s.x&&o>=t.y&&h<=s.y&&c.push(e)}));const h=(0,n.difference)(c,this.renderedMapFeatures[o]);a.add(...h);const d=(0,n.difference)(this.renderedMapFeatures[o],c);a.remove(...d),this.renderedMapFeatures[o]=c})),this.canvas?.requestRenderAll(),console.log(`objects count: ${this.renderedMapFeatures.flat().length}`),console.timeEnd("renderViewport")}render(){const e=["#ffcc66","#ccff66","#66ccff","#ff6fcf","#ff6666"],t=e.length-1,s=this.canvas.getWidth(),n=this.canvas.getHeight();for(let i=0;i<1e4;i++){const o=new r.Cd({left:(0,a.X)(0,s),top:(0,a.X)(0,n),radius:3,fill:e[(0,a.X)(0,t)],objectCaching:!1}),c=Math.floor(i/1e3);this.drawGroup[c]||(this.drawGroup[c]=[]),this.drawGroup[c].push(o)}for(let e=0;e<this.drawGroup.length;e++){const t=new r.ZA([],{objectCaching:!1,selectable:!1,evented:!1});t.set({id:`group_${e}`}),this.canvas?.add(t)}}renderViewport(){this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame((()=>{this.renderViewport()})),this.stats.begin(),this.isObjectInViewport(),this.stats.end(),this.metrics.setGui({FPS:this.stats.FPS})}reset(){super.reset(),this.drawGroup=[[]],this.renderedMapFeatures=[[]]}}},7217:(e,t,s)=>{s.d(t,{X:()=>r});const r=(e,t)=>Math.floor(Math.random()*(t-e))+e}}]);