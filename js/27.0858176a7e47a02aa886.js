(self.webpackChunkreact_base=self.webpackChunkreact_base||[]).push([[27],{3986:(t,e,s)=>{"use strict";s.d(e,{C3:()=>c,Of:()=>p,jk:()=>h});var i=s(1527),r=s(2625),n=s(4727),o=s(959),a=s(4222);const p=(0,n.Pi)((t=>{const[e,s]=(0,o.useState)({FPS:0,zoom:1,vptCoordsTL:"0, 0",vptCoordsBR:"0, 0"});return(0,o.useEffect)((()=>{s({...e,...t})}),[t]),(0,i.jsx)(a.ZP,{data:e,onUpdate:()=>{},liveUpdate:!1,style:{position:"absolute",height:"fit-content",left:0,bottom:0,top:"unset",right:"unset"},children:(0,i.jsxs)(a.zI,{title:"Fabric.js",closed:!1,children:[(0,i.jsx)(a.OM,{path:"FPS",label:"FPS"}),(0,i.jsx)(a.OM,{path:"zoom",label:"zoom"}),(0,i.jsx)(a.OM,{path:"vptCoordsTL",label:"vptCoordsTL"}),(0,i.jsx)(a.OM,{path:"vptCoordsBR",label:"vptCoordsBR"})]})})}));class h{beginTime;prevTime;frames;FPS;constructor(){this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.FPS=0}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;const t=(performance||Date).now();return t>=this.prevTime+1e3&&(this.FPS=Math.round(1e3*this.frames/(t-this.prevTime)),this.prevTime=t,this.frames=0),t}update(){this.beginTime=this.end()}}class c{gui;constructor(){(0,r.ky)(this),this.gui={FPS:0,zoom:1,vptCoordsTL:"0, 0",vptCoordsBR:"0, 0"}}setGui(t){this.gui={...this.gui,...t}}}},5253:(t,e,s)=>{"use strict";var i;s.d(e,{p:()=>r}),function(t){t.DEFAULT="DEFAULT",t.RESIZE="RESIZE"}(i||(i={}));const r=()=>{const t=new Map;return{lock:t,handler:(e,s=i.DEFAULT)=>{let r;return r=t.has(s)?t.get(s):window.requestAnimationFrame((i=>{e(i),t.delete(s)})),t.set(s,r),e=>{const s=t.get(e);t.delete(e),window.cancelAnimationFrame(s??0)}}}}},1197:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>u});var i=s(1527),r=s(2699),n=s(4727),o=s(4437),a=s(959),p=s(3986),h=s(5253),c=s(7217);const{handler:d}=(0,h.p)();class l{app;rightMouseDown=!1;lastTransform=null;stats;metrics;constructor(t){this.app=t,this.appEvnets(),this.stats=new p.jk,this.metrics=new p.C3}appEvnets(){this.app&&(this.app.view.addEventListener?.("wheel",(t=>{d((()=>this.appWheelHandler(t)))})),this.app.view.addEventListener?.("mousemove",(t=>{d((()=>this.appMoveHandler(t)))})),this.app.view.addEventListener?.("contextmenu",(t=>{t.preventDefault()})),this.app.view.addEventListener?.("mousedown",(t=>{2===t.button&&(this.rightMouseDown=!0,this.app.view.style.cursor="move")})),this.app.view.addEventListener?.("mouseup",(t=>{2===t.button&&(this.rightMouseDown=!1,this.app.view.style.cursor="default")})),this.app.ticker.add(this.rafRender.bind(this)))}appWheelHandler(t){if(!this.app)return;let{x:e}=this.app.stage.scale;e*=.999**(2*t.deltaY),e>16&&(e=16),e<.0625&&(e=.0625);const s=t.offsetX,i=t.offsetY,r=this.app.stage.toLocal(new o.E9j(s,i)),n=s-r.x*e,a=i-r.y*e;this.app.stage.position.set(n,a),this.app.stage.scale.set(e),this.metrics.setGui({zoom:e}),this.app.renderer.render(this.app.stage)}appMoveHandler(t){if(!this.rightMouseDown||!this.app)return;const{x:e,y:s}=this.app.stage.position,i=e+t.movementX,r=s+t.movementY;this.app.stage.position.set(i,r),this.app.renderer.render(this.app.stage)}render(){if(!this.app)return;const t=new o.W20;this.app.stage.addChild(t);const e=["#ffcc66","#ccff66","#66ccff","#ff6fcf","#ff6666"],s=e.length-1;for(let i=0;i<1e4;i++){const i=new o.TCu;i.beginFill(e[(0,c.X)(0,s)]),i.drawCircle(0,0,3),i.x=Math.random()*this.app.screen.width,i.y=Math.random()*this.app.screen.height,i.endFill(),t.addChild(i)}this.app.start()}recursionNode(t,e){t?.forEach((t=>{t.children?.length?this.recursionNode(t.children,e):e(t)}))}isObjectInViewport(){if(!this.app)return;const t=this.app.stage.worldTransform;if((0,r.isEqual)(this.lastTransform,t))return;console.time("renderViewport"),this.lastTransform=t.clone();const{left:e,top:s,right:i,bottom:n,width:a,height:p}=this.app.screen,h=new o.E9j(e,s),c=new o.E9j(i,n),d=t.applyInverse(h),l=t.applyInverse(c);this.metrics.setGui({vptCoordsTL:`${d.y.toFixed(0)}, ${d.x.toFixed(0)}`,vptCoordsBR:`${l.y.toFixed(0)}, ${l.x.toFixed(0)}`});let u=0;this.recursionNode(this.app.stage.children,(t=>{const e=t.getBounds(),s=e.left+e.width,i=e.top+e.height,r=e.right-e.width,n=e.bottom-e.height;s>=0&&i>=0&&r<=a&&n<=p?(u++,t.visible=!0):t.visible=!1})),this.app.renderer.render(this.app.stage),console.log(`objects count: ${u}`),console.timeEnd("renderViewport")}rafRender(){this.app&&(this.stats.begin(),this.isObjectInViewport(),this.stats.end(),this.metrics.setGui({FPS:this.stats.FPS}))}reset(){this.app?.stop(),this.app?.destroy(),this.app=null}}const u=(0,n.Pi)((()=>{const t=(0,a.useRef)(null),e=(0,a.useRef)();(0,a.useEffect)((()=>{if(t.current){const{offsetWidth:s,offsetHeight:i}=t.current,r=new o.MxU({width:s,height:i,backgroundColor:"#232829",autoStart:!1});return t.current.appendChild(r.view),e.current=new l(r),e.current.render(),()=>{t.current?.removeChild(r.view),e.current?.reset()}}}),[t.current]);const[s,n]=(0,a.useState)({});return(0,a.useEffect)((()=>{(0,r.isEqual)(e.current?.metrics.gui,s)||n({...e.current?.metrics.gui})}),[e.current?.metrics.gui]),(0,i.jsx)("div",{ref:t,style:{width:"100%",height:"100%",display:"flex",position:"relative"},children:(0,i.jsx)(p.Of,{...s})})}))},7217:(t,e,s)=>{"use strict";s.d(e,{X:()=>i});const i=(t,e)=>Math.floor(Math.random()*(e-t))+t},7002:()=>{}}]);