"use strict";(self.webpackChunkreact_base=self.webpackChunkreact_base||[]).push([[742],{1742:(e,s,t)=>{t.r(s),t.d(s,{default:()=>w});var i=t(1527),n=t(4727),r=t(959),o=t(6416),a=t(2699),h=t(2625),d=t(7327),c=t(3418),l=t(176),u=t(9800);const m={resize:!0,control:!0};class p{options;container;camera;scene;renderer;controls;resizeObserver;constructor(e,s){this.options=Object.assign({},m,s),this.container=e,this.scene=new d.xsS,this.camera=new d.cPb,this.renderer=new d.CP7({antialias:!0}),this.container.appendChild(this.renderer.domElement),this.resizeObserver=new ResizeObserver((0,a.debounce)(this.resize.bind(this),200)),this.resize(),this.options.resize&&this.resizeObserver.observe(this.container),this.options.control&&(this.controls=new c.z(this.camera,this.renderer.domElement))}resize(){const{offsetWidth:e,offsetHeight:s}=this.container;this.camera.aspect=e/s,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e,s)}render(){this.controls?.update(),this.renderer?.render(this.scene,this.camera)}rafRender(e){this.renderer?.setAnimationLoop(((...s)=>{e?.(...s),this.render()}))}dispose(){this.resizeObserver.disconnect(),this.renderer&&this.container.removeChild(this.renderer.domElement)}}class g extends p{gui;panel;ambientLight;directionalLight;model;constructor(e,s){super(e,s),(0,h.rC)(this,{model:h.LO}),this.gui=new l.XS,this.panel=new f(this.gui),this.container.appendChild(this.gui.domElement),this.ambientLight=new d.Mig,this.directionalLight=new d.Ox3,this.scene.add(this.ambientLight,this.directionalLight),this.init()}init(){this.camera.position.set(0,.5,1),this.controls&&(this.controls.enableDamping=!0),this.addGUI()}addGUI(){const e=this.panel.addUpload(this.updateModel.bind(this)).addGrid().addAxes();this.scene.add(e.grid,e.axes)}updateModel(e){this.model&&this.scene.remove(this.model),(0,h.z)((()=>{if(this.model=e.scene,this.model.rotateX(-Math.PI/2),this.scene.add(this.model),e.animations.length){const s=new d.Xcj(this.model);e.animations.forEach((e=>{s.clipAction(e).play()})),this.model.userData.mixer=s}}))}dispose(){super.dispose(),this.container.removeChild(this.gui.domElement)}}class f{gui;grid;axes;#e;constructor(e){this.gui=e,this.gui.close(),this.gui.domElement.style.position="absolute",this.grid=new d.VLJ,this.axes=new d.y8_;const s=new d.Ilk(16711680),t=new d.Ilk(65280),i=new d.Ilk(255);this.axes.setColors(s,t,i),this.#e=[s,t,i]}addUpload(e,s,t){const i=new x,n={upload:i.upload.bind(i)};return this.gui.add(n,"upload").name("上传gltf模型"),i.load(e,s,t),this}addGrid(){return this.gui.add(this.grid,"visible").name("网格"),this}addAxes(){this.gui.add(this.axes,"visible").name("坐标轴").onChange((s=>{s?e.show():e.hide()}));const e=this.gui.addFolder("坐标轴").show(this.axes.visible),s={length:1};return e.add(s,"length",0,100,1).name("长度").onChange((()=>{this.axes.scale.set(s.length,s.length,s.length)})),e.addColor(this.#e,"0").name("X").onChange((()=>{this.axes.setColors(...this.#e)})),e.addColor(this.#e,"1").name("Y").onChange((()=>{this.axes.setColors(...this.#e)})),e.addColor(this.#e,"2").name("Z").onChange((()=>{this.axes.setColors(...this.#e)})),this}}class x{input;onLoad;onProgress;onError;constructor(){this.input=document.createElement("input"),this.input.type="file",this.input.accept=".gltf",this.onLoad=()=>{}}load(e,s,t){this.onLoad=e,this.onProgress=s,this.onError=t}upload(){this.input.addEventListener("change",this.change.bind(this)),this.input.click()}async change(){const{files:e}=this.input;if(!e)return o.ZP.warning("请选择文件");if(!e[0].name.endsWith(".gltf"))return o.ZP.warning("请选择.gltf文件");const s=new u.E;try{const t=await s.loadAsync(URL.createObjectURL(e[0]),this.onProgress?.bind(this));this.onLoad(t)}catch(e){this.onError?.(e)}finally{this.dispose()}}dispose(){this.input.removeEventListener("change",this.change.bind(this))}}const b=(0,n.Pi)((()=>{const e=(0,r.useRef)(null),s=(0,r.useRef)(),t=(0,r.useRef)({speed:.6}),n=(0,r.useRef)();return(0,r.useEffect)((()=>{if(e.current){s.current=new g(e.current);let i=0;return s.current.rafRender((e=>{if(!s.current?.model?.userData.mixer)return void(i=0);const n=(e-i)/1e3;s.current.model.userData.mixer.update(n*t.current.speed),i=e})),()=>{s.current?.dispose()}}}),[]),(0,r.useEffect)((()=>{n.current&&n.current.destroy(),s.current?.model?.userData.mixer&&(n.current=s.current.gui.addFolder("动画"),n.current.add(t.current,"speed",0,2,.01).name("速度"))}),[s.current?.model?.userData.mixer]),(0,i.jsx)("div",{ref:e,className:"all-full relative overflow-hidden"})})),w=b}}]);