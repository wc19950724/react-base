"use strict";(self.webpackChunkreact_base=self.webpackChunkreact_base||[]).push([[742],{1742:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var i=s(1527),n=s(4727),r=s(959),o=s(6416),a=s(2699),d=s(2625),h=s(7327),l=s(3418),c=s(176),u=s(9800);const m={resize:!0,control:!0};class p{options;container;camera;scene;renderer;controls;resizeObserver;constructor(e,t){this.options=Object.assign({},m,t),this.container=e,this.scene=new h.xsS,this.camera=new h.cPb,this.renderer=new h.CP7({antialias:!0}),this.container.appendChild(this.renderer.domElement),this.resizeObserver=new ResizeObserver((0,a.debounce)(this.resize.bind(this),200)),this.resize(),this.options.resize&&this.resizeObserver.observe(this.container),this.options.control&&(this.controls=new l.z(this.camera,this.renderer.domElement))}resize(){const{offsetWidth:e,offsetHeight:t}=this.container;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e,t)}render(){this.controls?.update(),this.renderer?.render(this.scene,this.camera)}rafRender(e){this.renderer?.setAnimationLoop(((...t)=>{e?.(...t),this.render()}))}dispose(){this.resizeObserver.disconnect(),this.renderer&&this.container.removeChild(this.renderer.domElement)}}class g extends p{gui;panel;ambientLight;directionalLight;model;constructor(e,t){super(e,t),(0,d.rC)(this,{model:d.LO,updateModel:d.aD}),this.gui=new c.XS,this.panel=new f(this.gui),this.container.appendChild(this.gui.domElement),this.ambientLight=new h.Mig,this.directionalLight=new h.Ox3,this.scene.add(this.ambientLight,this.directionalLight),this.init()}init(){this.camera.position.set(0,.5,1),this.controls&&(this.controls.enableDamping=!0),this.addGUI()}addGUI(){const e=this.panel.addUpload(this.updateModel.bind(this)).addGrid().addAxes();this.scene.add(e.grid,e.axes)}updateModel(e){if(this.model&&this.scene.remove(this.model),this.model=e.scene,this.model.rotateX(-Math.PI/2),this.scene.add(this.model),e.animations.length){const t=new h.Xcj(this.model),s=[];e.animations.forEach((e=>{const i=t.clipAction(e);s.push(i)})),this.model.userData.actions=s,this.model.userData.mixer=t}}updateAnimation(e){if(!this.model)return;const{actions:t}=this.model.userData;e?t.forEach((e=>e.play())):t.forEach((e=>e.stop()))}dispose(){super.dispose(),this.container.removeChild(this.gui.domElement)}}class f{gui;grid;axes;#e;constructor(e){this.gui=e,this.gui.close(),this.gui.domElement.style.position="absolute",this.grid=new h.VLJ,this.axes=new h.y8_;const t=new h.Ilk(16711680),s=new h.Ilk(65280),i=new h.Ilk(255);this.axes.setColors(t,s,i),this.#e=[t,s,i]}addUpload(e,t,s){const i=new x,n={upload:i.upload.bind(i)};return this.gui.add(n,"upload").name("上传gltf模型"),i.load(e,t,s),this}addGrid(){return this.gui.add(this.grid,"visible").name("网格"),this}addAxes(){this.gui.add(this.axes,"visible").name("坐标轴").onChange((t=>{t?e.show():e.hide()}));const e=this.gui.addFolder("坐标轴").show(this.axes.visible),t={length:1};return e.add(t,"length",0,100,1).name("长度").onChange((()=>{this.axes.scale.set(t.length,t.length,t.length)})),e.addColor(this.#e,"0").name("X").onChange((()=>{this.axes.setColors(...this.#e)})),e.addColor(this.#e,"1").name("Y").onChange((()=>{this.axes.setColors(...this.#e)})),e.addColor(this.#e,"2").name("Z").onChange((()=>{this.axes.setColors(...this.#e)})),this}}class x{input;onLoad;onProgress;onError;constructor(){this.input=document.createElement("input"),this.input.type="file",this.input.accept=".gltf",this.onLoad=()=>{}}load(e,t,s){this.onLoad=e,this.onProgress=t,this.onError=s}upload(){this.input.addEventListener("change",this.change.bind(this)),this.input.click()}async change(){const{files:e}=this.input;if(!e)return o.ZP.warning("请选择文件");if(!e[0].name.endsWith(".gltf"))return o.ZP.warning("请选择.gltf文件");const t=new u.E;try{const s=await t.loadAsync(URL.createObjectURL(e[0]),this.onProgress?.bind(this));this.onLoad(s)}catch(e){this.onError?.(e)}finally{this.dispose()}}dispose(){this.input.removeEventListener("change",this.change.bind(this))}}const b=(0,n.Pi)((()=>{const e=(0,r.useRef)(null),[t,s]=(0,r.useState)(),n=(0,r.useRef)({play:!1,speed:.6}),o=(0,r.useRef)();return(0,r.useEffect)((()=>{if(e.current){const t=new g(e.current);s(t);let i=0;return t.rafRender((e=>{const s=t.model?.userData;if(!s?.mixer)return void(i=0);const r=(e-i)/1e3;s.mixer.update(r*n.current.speed),i=e})),()=>{t.dispose()}}}),[]),(0,r.useEffect)((()=>{o.current&&o.current.destroy(),t?.model&&t.model.userData.mixer&&(t.updateAnimation(n.current.play),o.current=t.gui.addFolder("动画"),o.current.add(n.current,"play").name("播放").onChange(t.updateAnimation.bind(t)),o.current.add(n.current,"speed",0,2,.01).name("速度"))}),[t?.model?.userData.mixer]),(0,i.jsx)("div",{ref:e,className:"all-full relative overflow-hidden"})})),C=b}}]);