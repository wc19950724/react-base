(self.webpackChunkreact_base=self.webpackChunkreact_base||[]).push([[27],{3986:(e,t,s)=>{"use strict";s.d(t,{C3:()=>c,Of:()=>p,jk:()=>h});var i=s(1527),r=s(2625),n=s(4727),o=s(959),a=s(4222);const p=(0,n.Pi)((e=>{const[t,s]=(0,o.useState)({FPS:0,zoom:1,vptCoordsTL:"0, 0",vptCoordsBR:"0, 0"});return(0,o.useEffect)((()=>{s({...t,...e})}),[e]),(0,i.jsx)(a.ZP,{data:t,onUpdate:()=>{},liveUpdate:!1,style:{position:"absolute",height:"fit-content",left:0,bottom:0,top:"unset",right:"unset"},children:(0,i.jsxs)(a.zI,{title:"Fabric.js",closed:!1,children:[(0,i.jsx)(a.OM,{path:"FPS",label:"FPS"}),(0,i.jsx)(a.OM,{path:"zoom",label:"zoom"}),(0,i.jsx)(a.OM,{path:"vptCoordsTL",label:"vptCoordsTL"}),(0,i.jsx)(a.OM,{path:"vptCoordsBR",label:"vptCoordsBR"})]})})}));class h{beginTime;prevTime;frames;FPS;constructor(){this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.FPS=0}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;const e=(performance||Date).now();return e>=this.prevTime+1e3&&(this.FPS=Math.round(1e3*this.frames/(e-this.prevTime)),this.prevTime=e,this.frames=0),e}update(){this.beginTime=this.end()}}class c{gui;constructor(){(0,r.ky)(this),this.gui={FPS:0,zoom:1,vptCoordsTL:"0, 0",vptCoordsBR:"0, 0"}}setGui(e){this.gui={...this.gui,...e}}}},5253:(e,t,s)=>{"use strict";var i;s.d(t,{p:()=>r}),function(e){e.DEFAULT="DEFAULT",e.RESIZE="RESIZE"}(i||(i={}));const r=()=>{const e=new Map;return{lock:e,handler:(t,s=i.DEFAULT)=>{let r;return r=e.has(s)?e.get(s):window.requestAnimationFrame((i=>{t(i),e.delete(s)})),e.set(s,r),t=>{const s=e.get(t);e.delete(t),window.cancelAnimationFrame(s??0)}}}}},1197:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var i=s(1527),r=s(2699),n=s(4727),o=s(4437),a=s(959),p=s(3986),h=s(5253),c=s(7217);const{handler:d}=(0,h.p)();class l{app;rightMouseDown=!1;lastTransform=null;stats;metrics;constructor(e){this.app=e,this.appEvnets(),this.stats=new p.jk,this.metrics=new p.C3}appEvnets(){this.app&&(this.app.view.addEventListener?.("wheel",(e=>{d((()=>this.appWheelHandler(e)))})),this.app.view.addEventListener?.("mousemove",(e=>{d((()=>this.appMoveHandler(e)))})),this.app.view.addEventListener?.("contextmenu",(e=>{e.preventDefault()})),this.app.view.addEventListener?.("mousedown",(e=>{2===e.button&&(this.rightMouseDown=!0,this.app.view.style.cursor="move")})),this.app.view.addEventListener?.("mouseup",(e=>{2===e.button&&(this.rightMouseDown=!1,this.app.view.style.cursor="default")})),this.app.ticker.add(this.rafRender.bind(this)))}appWheelHandler(e){if(!this.app)return;let{x:t}=this.app.stage.scale;t*=.999**(2*e.deltaY),t>16&&(t=16),t<.0625&&(t=.0625);const s=e.offsetX,i=e.offsetY,r=this.app.stage.toLocal(new o.E9j(s,i)),n=s-r.x*t,a=i-r.y*t;this.app.stage.position.set(n,a),this.app.stage.scale.set(t),this.metrics.setGui({zoom:t}),this.app.renderer.render(this.app.stage)}appMoveHandler(e){if(!this.rightMouseDown||!this.app)return;const{x:t,y:s}=this.app.stage.position,i=t+e.movementX,r=s+e.movementY;this.app.stage.position.set(i,r),this.app.renderer.render(this.app.stage)}render(){if(!this.app)return;const e=new o.W20;this.app.stage.addChild(e);const t=["#ffcc66","#ccff66","#66ccff","#ff6fcf","#ff6666"],s=t.length-1;for(let i=0;i<1e4;i++){const i=new o.TCu;i.beginFill(t[(0,c.XF)(0,s)]),i.drawCircle(0,0,3),i.x=Math.random()*this.app.screen.width,i.y=Math.random()*this.app.screen.height,i.endFill(),e.addChild(i)}this.app.start()}recursionNode(e,t){e?.forEach((e=>{e.children?.length?this.recursionNode(e.children,t):t(e)}))}isObjectInViewport(){if(!this.app)return;const e=this.app.stage.worldTransform;if((0,r.isEqual)(this.lastTransform,e))return;console.time("renderViewport"),this.lastTransform=e.clone();const{left:t,top:s,right:i,bottom:n,width:a,height:p}=this.app.screen,h=new o.E9j(t,s),c=new o.E9j(i,n),d=e.applyInverse(h),l=e.applyInverse(c);this.metrics.setGui({vptCoordsTL:`${d.y.toFixed(0)}, ${d.x.toFixed(0)}`,vptCoordsBR:`${l.y.toFixed(0)}, ${l.x.toFixed(0)}`});let u=0;this.recursionNode(this.app.stage.children,(e=>{const t=e.getBounds(),s=t.left+t.width,i=t.top+t.height,r=t.right-t.width,n=t.bottom-t.height;s>=0&&i>=0&&r<=a&&n<=p?(u++,e.visible=!0):e.visible=!1})),this.app.renderer.render(this.app.stage),console.log(`objects count: ${u}`),console.timeEnd("renderViewport")}rafRender(){this.app&&(this.stats.begin(),this.isObjectInViewport(),this.stats.end(),this.metrics.setGui({FPS:this.stats.FPS}))}reset(){this.app?.stop(),this.app?.destroy(),this.app=null}}const u=(0,n.Pi)((()=>{const e=(0,a.useRef)(null),t=(0,a.useRef)();(0,a.useEffect)((()=>{if(e.current){const{offsetWidth:s,offsetHeight:i}=e.current,r=new o.MxU({width:s,height:i,backgroundColor:"#232829",autoStart:!1});return e.current.appendChild(r.view),t.current=new l(r),t.current.render(),()=>{e.current?.removeChild(r.view),t.current?.reset()}}}),[e.current]);const[s,n]=(0,a.useState)({});return(0,a.useEffect)((()=>{(0,r.isEqual)(t.current?.metrics.gui,s)||n({...t.current?.metrics.gui})}),[t.current?.metrics.gui]),(0,i.jsx)("div",{ref:e,style:{width:"100%",height:"100%",display:"flex",position:"relative"},children:(0,i.jsx)(p.Of,{...s})})}))},7217:(e,t,s)=>{"use strict";s.d(t,{XF:()=>i,sb:()=>r,tr:()=>n});const i=(e,t)=>Math.floor(Math.random()*(t-e))+e,r=e=>"string"==typeof e?document.querySelector(e):e,n=(e,t,s)=>new RegExp(`\\.${t}$`,s).test(e.name)},7002:()=>{}}]);